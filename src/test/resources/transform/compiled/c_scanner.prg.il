PROGRAMSTART:
JSR START
0:
NOP
MOVB 53280,#15{INTEGER}
NOP
MOVB 53281,#15{INTEGER}
NOP
MOVB 646,#0{INTEGER}
NOP
JSR COMPACTMAX
MOV Y,#0{INTEGER}
CHGCTX #1
JSR CHR
JSR COPYSTR
MOV C0${STRING},A
10:
NOP
JSR COMPACTMAX
MOV Y,#147{INTEGER}
CHGCTX #1
JSR CHR
JSR STROUT
NOP
MOV A,#disk scanner{STRING}
JSR STROUT
JSR LINEBREAK
NOP
JSR LINEBREAK
NOP
MOV Y,#0{INTEGER}
MOV LB{REAL},Y
NOP
MOV Y,#0{INTEGER}
MOV CB{REAL},Y
NOP
MOV Y,#0{INTEGER}
MOV XM{REAL},Y
15:
NOP
MOV A,#search term can be hex or ascii.{STRING}
JSR STROUT
JSR LINEBREAK
16:
NOP
MOV A,#for hex, use $ prefix. Like: $ffa01222{STRING}
JSR STROUT
JSR LINEBREAK
17:
NOP
MOV A,#for ascii, just enter the text.{STRING}
JSR STROUT
JSR LINEBREAK
NOP
JSR LINEBREAK
20:
NOP
INPUT0:
JSR CLEARQUEUE
JSR COMPACTMAX
MOV A,#search for{STRING}
JSR STROUT
JSR QMARKOUT1
JSR INPUTSTR
JSR INPUTLENGTHCHECK
JE EMPTYINPUTSKIP1
MOV T${STRING},A
EMPTYINPUTSKIP1:
JSR QUEUESIZE
CMP X,#0{REAL}
JE INPUTCHECK0
JSR EXTRAIGNORED
INPUTCHECK0:
25:
NOP
MOV Y,#0{INTEGER}
MOV ER{REAL},Y
NOP
JSR GOSUB
JSR 3000
NOP
MOV Y,#1{INTEGER}
MOV X,ER{REAL}
EQ X,Y
CMP X,#0{REAL}
JNE NSKIP0
JMP SKIP0
NSKIP0:
JMP 10
NOP
SKIP0:
26:
NOP
INPUT1:
JSR CLEARQUEUE
JSR COMPACTMAX
MOV A,#start at track{STRING}
JSR STROUT
JSR QMARKOUT1
JSR INPUTNUMBER
CMP X,#0{REAL}
JE INPUT1_0
MOV A,#?redo from start{STRING}
JSR STROUT
JSR LINEBREAK
JMP INPUT1
INPUT1_0:
JSR INPUTLENGTHCHECK
JE EMPTYINPUTSKIP2
MOV TT{REAL},Y
EMPTYINPUTSKIP2:
JSR QUEUESIZE
CMP X,#0{REAL}
JE INPUTCHECK1
JSR EXTRAIGNORED
INPUTCHECK1:
30:
NOP
JSR COMPACTMAX
MOV Y,#147{INTEGER}
CHGCTX #1
JSR CHR
JSR STROUT
NOP
MOV A,#scanning for{STRING}
JSR STROUT
JSR LINEBREAK
NOP
MOV A,T${STRING}
JSR STROUT
JSR LINEBREAK
NOP
JSR LINEBREAK
35:
NOP
MOV Y,#0{INTEGER}
MOV CB{REAL},Y
NOP
MOV Y,#35{INTEGER}
MOV X,TT{REAL}
GT X,Y
PUSH X
MOV Y,#1{INTEGER}
MOV X,TT{REAL}
LT X,Y
POP Y
OR X,Y
CMP X,#0{REAL}
JNE NSKIP1
JMP SKIP1
NSKIP1:
NOP
MOV Y,#1{INTEGER}
MOV TT{REAL},Y
NOP
SKIP1:
40:
NOP
MOV B,#000000{STRING}
MOV TI${STRING},B
NOP
MOV Y,#1{INTEGER}
PUSH Y
MOV Y,#8{INTEGER}
PUSH Y
MOV D,#15{INTEGER}
POP C
POP X
MOV Y,#3{INTEGER}
JSR OPEN
NOP
MOV Y,#2{INTEGER}
PUSH Y
MOV Y,#8{INTEGER}
PUSH Y
MOV Y,#2{INTEGER}
PUSH Y
MOV B,##{STRING}
MOV G,B
POP D
POP C
POP X
MOV Y,#4{INTEGER}
JSR OPEN
42:
NOP
MOV Y,TT{REAL}
MOV T{REAL},Y
NOP
MOV Y,#0{INTEGER}
MOV S{REAL},Y
NOP
MOV Y,#21{INTEGER}
MOV SM{REAL},Y
NOP
MOV Y,#0{INTEGER}
MOV TS{REAL},Y
NOP
MOV Y,#0{INTEGER}
MOV SS{REAL},Y
NOP
MOV Y,#0{INTEGER}
MOV SB{REAL},Y
43:
NOP
MOV Y,#17{INTEGER}
MOV X,T{REAL}
GT X,Y
CMP X,#0{REAL}
JNE NSKIP2
JMP SKIP2
NSKIP2:
NOP
MOV Y,#19{INTEGER}
MOV SM{REAL},Y
NOP
SKIP2:
44:
NOP
MOV Y,#24{INTEGER}
MOV X,T{REAL}
GT X,Y
CMP X,#0{REAL}
JNE NSKIP3
JMP SKIP3
NSKIP3:
NOP
MOV Y,#18{INTEGER}
MOV SM{REAL},Y
NOP
SKIP3:
45:
NOP
MOV Y,#30{INTEGER}
MOV X,T{REAL}
GT X,Y
CMP X,#0{REAL}
JNE NSKIP4
JMP SKIP4
NSKIP4:
NOP
MOV Y,#17{INTEGER}
MOV SM{REAL},Y
NOP
SKIP4:
50:
NOP
JSR LOCKCHANNEL
MOV Y,#1{INTEGER}
PUSH Y
NOP
MOV A,#u1:{STRING}
POP C
JSR STROUTCHANNEL
PUSH C
NOP
MOV X,#2{INTEGER}
POP C
JSR INTOUTCHANNEL
MOV A,# {STRING}
JSR STROUTCHANNEL
PUSH C
NOP
MOV X,#0{INTEGER}
POP C
JSR INTOUTCHANNEL
MOV A,# {STRING}
JSR STROUTCHANNEL
PUSH C
NOP
MOV X,T{REAL}
POP C
JSR REALOUTCHANNEL
MOV A,# {STRING}
JSR STROUTCHANNEL
PUSH C
NOP
MOV X,S{REAL}
POP C
JSR REALOUTCHANNEL
MOV A,# {STRING}
JSR STROUTCHANNEL
JSR LINEBREAKCHANNEL
JSR UNLOCKCHANNEL
NOP
MOV Y,#0{INTEGER}
MOV SC{REAL},Y
52:
NOP
MOVB 781,#2{INTEGER}
NOP
JSR $ffc6
55:
NOP
MOV X,T{REAL}
MOVB 1061,X
NOP
MOV X,S{REAL}
MOVB 1062,X
70:
NOP
JSR GETSTR
MOV A${STRING},A
NOP
JSR COMPACTMAX
MOV B,C0${STRING}
MOV A,A${STRING}
JSR CONCAT
MOV B,A
CHGCTX #0
JSR ASC
MOV C%{INTEGER},X
72:
NOP
MOV X,SC{REAL}
MOVB 1063,X
75:
NOP
MOV X,CB{REAL}
MOV G,BY%[]{INTEGER}
CHGCTX #0
JSR ARRAYACCESS
MOV Y,C%{INTEGER}
NEQ X,Y
CMP X,#0{REAL}
JNE NSKIP5
JMP SKIP5
NSKIP5:
NOP
MOV Y,CB{REAL}
MOV CO{REAL},Y
NOP
MOV Y,#0{INTEGER}
MOV CB{REAL},Y
NOP
MOV Y,#0{INTEGER}
MOV X,CO{REAL}
GT X,Y
CMP X,#0{REAL}
JNE NSKIP6
JMP SKIP6
NSKIP6:
JSR GOSUB
JSR 1000
NOP
SKIP6:
NOP
SKIP5:
80:
NOP
MOV X,CB{REAL}
MOV G,BY%[]{INTEGER}
CHGCTX #0
JSR ARRAYACCESS
MOV Y,C%{INTEGER}
EQ X,Y
CMP X,#0{REAL}
JNE NSKIP7
JMP SKIP7
NSKIP7:
NOP
MOV Y,#1{INTEGER}
MOV X,CB{REAL}
ADD X,Y
MOV CB{REAL},X
JSR GOSUB
JSR 2000
NOP
SKIP7:
90:
NOP
MOV Y,#1{INTEGER}
MOV X,CB{REAL}
EQ X,Y
CMP X,#0{REAL}
JNE NSKIP8
JMP SKIP8
NSKIP8:
NOP
MOV Y,T{REAL}
MOV TS{REAL},Y
NOP
MOV Y,S{REAL}
MOV SS{REAL},Y
NOP
MOV Y,SC{REAL}
MOV SB{REAL},Y
NOP
SKIP8:
100:
NOP
MOV Y,LB{REAL}
MOV X,CB{REAL}
EQ X,Y
CMP X,#0{REAL}
JNE NSKIP9
JMP SKIP9
NSKIP9:
JSR GOSUB
JSR 200
NOP
SKIP9:
110:
NOP
MOV Y,#1{INTEGER}
MOV X,SC{REAL}
ADD X,Y
MOV SC{REAL},X
NOP
MOV Y,#256{INTEGER}
MOV X,SC{REAL}
LT X,Y
CMP X,#0{REAL}
JNE NSKIP10
JMP SKIP10
NSKIP10:
JMP 70
NOP
SKIP10:
120:
NOP
MOV Y,#1{INTEGER}
MOV X,S{REAL}
ADD X,Y
MOV S{REAL},X
NOP
MOV Y,SM{REAL}
MOV X,S{REAL}
EQ X,Y
CMP X,#0{REAL}
JNE NSKIP11
JMP SKIP11
NSKIP11:
NOP
MOV Y,#0{INTEGER}
MOV S{REAL},Y
NOP
MOV Y,#1{INTEGER}
MOV X,T{REAL}
ADD X,Y
MOV T{REAL},X
NOP
SKIP11:
130:
NOP
MOV Y,#36{INTEGER}
MOV X,T{REAL}
LT X,Y
CMP X,#0{REAL}
JNE NSKIP12
JMP SKIP12
NSKIP12:
JMP 43
NOP
SKIP12:
160:
NOP
JSR $ffcc
NOP
MOV X,#2{INTEGER}
JSR CLOSE
NOP
MOV X,#1{INTEGER}
JSR CLOSE
170:
NOP
MOV Y,#1{INTEGER}
PUSH Y
MOV Y,#8{INTEGER}
PUSH Y
MOV Y,#15{INTEGER}
PUSH Y
MOV B,#i{STRING}
MOV G,B
POP D
POP C
POP X
MOV Y,#4{INTEGER}
JSR OPEN
NOP
MOV X,#1{INTEGER}
JSR CLOSE
199:
NOP
JSR LINEBREAK
NOP
MOV A,#scan completed in {STRING}
JSR STROUT
NOP
MOV A,TI${STRING}
JSR STROUT
JSR LINEBREAK
NOP
JSR END
RTS
200:
NOP
MOV A,#found at track{STRING}
JSR STROUT
NOP
MOV X,TS{REAL}
JSR REALOUT
JSR CRSRRIGHT
NOP
MOV A,# sector{STRING}
JSR STROUT
NOP
MOV X,SS{REAL}
JSR REALOUT
JSR CRSRRIGHT
NOP
MOV A,# byte{STRING}
JSR STROUT
NOP
MOV X,SB{REAL}
JSR REALOUT
JSR LINEBREAK
210:
NOP
MOV Y,#0{INTEGER}
MOV CB{REAL},Y
NOP
JSR GOSUB
JSR 1000
NOP
JMP RETURN
1000:
NOP
MOV Y,#55336.0{REAL}
MOV I{REAL},Y
NOP
MOV Y,XM{REAL}
MOV X,LB{REAL}
MUL X,Y
MOV Y,#55336.0{REAL}
ADD X,Y
PUSH X
NOP
MOV Y,#1{INTEGER}
PUSH Y
MOV A,(I{REAL})
JSR INITFOR
1010:
NOP
MOV Y,I{REAL}
MOVB (Y),#0{INTEGER}
NOP
MOV A,#0{INTEGER}
JSR NEXT
CMP A,#0{INTEGER}
JE ($JUMP)
NOP
JMP RETURN
2000:
NOP
MOV Y,#55336.0{REAL}
MOV I{REAL},Y
NOP
MOV Y,XM{REAL}
MOV X,CB{REAL}
MUL X,Y
MOV Y,#55336.0{REAL}
ADD X,Y
MOV Y,#1{INTEGER}
SUB X,Y
PUSH X
NOP
MOV Y,#1{INTEGER}
PUSH Y
MOV A,(I{REAL})
JSR INITFOR
2010:
NOP
MOV Y,I{REAL}
MOVB (Y),#7{INTEGER}
NOP
MOV A,#0{INTEGER}
JSR NEXT
CMP A,#0{INTEGER}
JE ($JUMP)
NOP
JMP RETURN
3000:
NOP
MOV B,#{STRING}
MOV A,T${STRING}
CHGCTX #0
JSR SEQ
CMP X,#0{REAL}
JNE NSKIP13
JMP SKIP13
NSKIP13:
NOP
MOV Y,#1{INTEGER}
MOV ER{REAL},Y
JMP RETURN
NOP
SKIP13:
3010:
NOP
JSR COMPACTMAX
MOV B,#${STRING}
CHGCTX #0
PUSH B
MOV C,#1{INTEGER}
CHGCTX #1
MOV B,T${STRING}
JSR LEFT
POP B
CHGCTX #0
JSR SEQ
CMP X,#0{REAL}
JNE NSKIP14
JMP SKIP14
NSKIP14:
JMP 3100
NOP
SKIP14:
3020:
NOP
MOV B,T${STRING}
CHGCTX #0
JSR LEN
MOV LB{REAL},X
NOP
MOV Y,#1{INTEGER}
MOV XM{REAL},Y
3030:
NOP
MOV Y,#1{INTEGER}
MOV I{REAL},Y
NOP
MOV Y,LB{REAL}
PUSH Y
NOP
MOV Y,#1{INTEGER}
PUSH Y
MOV A,(I{REAL})
JSR INITFOR
NOP
JSR COMPACTMAX
MOV C,I{REAL}
MOV D,#1{INTEGER}
CHGCTX #1
MOV B,T${STRING}
JSR MID
JSR COPYSTR
MOV C1${STRING},A
3040:
NOP
MOV Y,CP{REAL}
PUSH Y
NOP
MOV B,C1${STRING}
CHGCTX #0
JSR ASC
MOV Y,X
POP X
MOV G,BY%[]{INTEGER}
JSR ARRAYSTORE
NOP
MOV Y,#1{INTEGER}
MOV X,CP{REAL}
ADD X,Y
MOV CP{REAL},X
NOP
MOV A,#0{INTEGER}
JSR NEXT
CMP A,#0{INTEGER}
JE ($JUMP)
NOP
JMP RETURN
3100:
NOP
JSR COMPACTMAX
MOV B,T${STRING}
JSR LEN
MOV Y,#1{INTEGER}
SUB X,Y
MOV C,X
CHGCTX #1
MOV B,T${STRING}
JSR RIGHT
JSR COPYSTR
MOV T${STRING},A
NOP
MOV B,T${STRING}
JSR LEN
MOV A,#1{INTEGER}
SHR X,A
MOV LB{REAL},X
NOP
MOV Y,#2{INTEGER}
MOV XM{REAL},Y
3105:
NOP
MOV B,T${STRING}
JSR LEN
MOV Y,#1{INTEGER}
AND X,Y
MOV Y,#1{INTEGER}
EQ X,Y
CMP X,#0{REAL}
JNE NSKIP15
JMP SKIP15
NSKIP15:
NOP
MOV Y,#1{INTEGER}
MOV ER{REAL},Y
JMP RETURN
NOP
SKIP15:
3110:
NOP
MOV Y,#1{INTEGER}
MOV I{REAL},Y
NOP
MOV X,LB{REAL}
MOV A,#1{INTEGER}
SHL X,A
PUSH X
NOP
MOV Y,#2{INTEGER}
PUSH Y
MOV A,(I{REAL})
JSR INITFOR
NOP
JSR COMPACTMAX
MOV C,I{REAL}
MOV D,#1{INTEGER}
CHGCTX #1
MOV B,T${STRING}
JSR MID
JSR COPYSTR
MOV C1${STRING},A
NOP
JSR COMPACTMAX
MOV Y,#1{INTEGER}
MOV X,I{REAL}
ADD X,Y
PUSH X
MOV C,#1{INTEGER}
PUSH C
CHGCTX #1
MOV B,T${STRING}
POP D
POP C
JSR MID
JSR COPYSTR
MOV C2${STRING},A
3120:
NOP
MOV B,C1${STRING}
CHGCTX #0
JSR ASC
MOV C1{REAL},X
NOP
MOV B,C2${STRING}
CHGCTX #0
JSR ASC
MOV C2{REAL},X
NOP
MOV Y,#64{INTEGER}
MOV X,C1{REAL}
GT X,Y
CMP X,#0{REAL}
JNE NSKIP16
JMP SKIP16
NSKIP16:
NOP
MOV Y,#7{INTEGER}
MOV X,C1{REAL}
SUB X,Y
MOV C1{REAL},X
NOP
SKIP16:
3130:
NOP
MOV Y,#64{INTEGER}
MOV X,C2{REAL}
GT X,Y
CMP X,#0{REAL}
JNE NSKIP17
JMP SKIP17
NSKIP17:
NOP
MOV Y,#7{INTEGER}
MOV X,C2{REAL}
SUB X,Y
MOV C2{REAL},X
NOP
SKIP17:
3140:
NOP
MOV Y,#48{INTEGER}
MOV X,C1{REAL}
SUB X,Y
MOV C1{REAL},X
NOP
MOV Y,#48{INTEGER}
MOV X,C2{REAL}
SUB X,Y
MOV C2{REAL},X
NOP
MOV X,C1{REAL}
MOV A,#4{INTEGER}
SHL X,A
MOV Y,C2{REAL}
ADD X,Y
MOV VL{REAL},X
3150:
NOP
MOV Y,#255{INTEGER}
MOV X,VL{REAL}
GT X,Y
PUSH X
MOV Y,#0{INTEGER}
MOV X,VL{REAL}
LT X,Y
POP Y
OR X,Y
CMP X,#0{REAL}
JNE NSKIP18
JMP SKIP18
NSKIP18:
NOP
MOV Y,#1{INTEGER}
MOV ER{REAL},Y
JMP RETURN
NOP
SKIP18:
3160:
NOP
MOV Y,CB{REAL}
PUSH Y
NOP
POP X
MOV Y,VL{REAL}
MOV G,BY%[]{INTEGER}
JSR ARRAYSTORE
NOP
MOV Y,#1{INTEGER}
MOV X,CB{REAL}
ADD X,Y
MOV CB{REAL},X
NOP
MOV A,#0{INTEGER}
JSR NEXT
CMP A,#0{INTEGER}
JE ($JUMP)
NOP
JMP RETURN
NOP
JSR END
RTS
