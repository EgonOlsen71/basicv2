PROGRAMSTART:
JSR START
0:
1:
NOP
MOV Y,#1{INTEGER}
MOV I{REAL},Y
NOP
MOV Y,#0{INTEGER}
MOV J{REAL},Y
NOP
MOV Y,#0{INTEGER}
MOV K{REAL},Y
NOP
MOV B,#cannot doyou walk opened   closed   a sword  a key    nothing{STRING}
MOV X${STRING},B
2:
NOP
JSR COMPACTMAX
MOV B,#  a chest  a dragon a corpse {STRING}
MOV A,X${STRING}
JSR CONCAT
JSR COPYSTR
MOV X${STRING},A
NOP
MOV B,#open chest{STRING}
MOV O${STRING},B
NOP
MOV B,#get sword{STRING}
MOV S${STRING},B
NOP
MOV B,#look {STRING}
MOV L${STRING},B
3:
NOP
MOV A,#you are in a {STRING}
JSR STROUT
NOP
JSR COMPACTMAX
MOV X,I{REAL}
MOV A,#2{INTEGER}
SHL X,A
MOV Y,#3{INTEGER}
SUB X,Y
PUSH X
MOV C,#4{INTEGER}
PUSH C
CHGCTX #1
MOV B,#cavepit halllake{STRING}
POP D
POP C
JSR MID
JSR STROUT
JSR LINEBREAK
NOP
INPUT0:
JSR CLEARQUEUE
JSR COMPACTMAX
MOV A,#{STRING}
JSR STROUT
JSR QMARKOUT1
JSR INPUTSTR
JSR INPUTLENGTHCHECK
JE EMPTYINPUTSKIP1
MOV U${STRING},A
EMPTYINPUTSKIP1:
JSR QUEUESIZE
CMP X,#0{REAL}
JE INPUTCHECK0
JSR EXTRAIGNORED
INPUTCHECK0:
4:
NOP
MOV B,#east{STRING}
MOV A,U${STRING}
CHGCTX #0
JSR SEQ
PUSH X
MOV Y,#3{INTEGER}
MOV X,I{REAL}
EQ X,Y
POP Y
AND X,Y
PUSH X
CHGCTX #1
MOV B,#west{STRING}
MOV A,U${STRING}
CHGCTX #0
JSR SEQ
PUSH X
MOV Y,#2{INTEGER}
MOV X,I{REAL}
EQ X,Y
POP Y
AND X,Y
PUSH X
MOV Y,#2{INTEGER}
MOV X,I{REAL}
GT X,Y
PUSH X
CHGCTX #1
MOV B,#south{STRING}
MOV A,U${STRING}
CHGCTX #0
JSR SEQ
MOV A,#1{INTEGER}
SHL X,A
POP Y
MUL X,Y
PUSH X
MOV Y,#3{INTEGER}
MOV X,I{REAL}
LT X,Y
PUSH X
CHGCTX #1
MOV B,#north{STRING}
MOV A,U${STRING}
CHGCTX #0
JSR SEQ
MOV A,#1{INTEGER}
SHL X,A
POP Y
MUL X,Y
POP Y
SUB X,Y
POP Y
SUB X,Y
POP Y
ADD X,Y
MOV M{REAL},X
5:
NOP
MOV Y,#0{INTEGER}
MOV X,M{REAL}
NEQ X,Y
PUSH X
CHGCTX #1
MOV B,#kill dragon{STRING}
MOV A,U${STRING}
CHGCTX #0
JSR SEQ
PUSH X
MOV Y,#3{INTEGER}
MOV X,I{REAL}
EQ X,Y
POP Y
AND X,Y
PUSH X
MOV Y,#2{INTEGER}
MOV X,K{REAL}
EQ X,Y
MOV Y,X
MOV X,#11{INTEGER}
SUB X,Y
POP Y
MUL X,Y
PUSH X
CHGCTX #1
MOV B,#look chest{STRING}
MOV A,U${STRING}
CHGCTX #0
JSR SEQ
PUSH X
MOV Y,#2{INTEGER}
MOV X,I{REAL}
EQ X,Y
POP Y
AND X,Y
PUSH X
MOV Y,#2{INTEGER}
MOV X,K{REAL}
EQ X,Y
MOV A,#1{INTEGER}
SHL X,A
PUSH X
MOV Y,J{REAL}
MOV X,#3{INTEGER}
ADD X,Y
POP Y
SUB X,Y
MOV Y,X
NEG X,Y
POP Y
MUL X,Y
POP Y
SUB X,Y
POP Y
SUB X,Y
MOV A{REAL},X
6:
NOP
JSR COMPACTMAX
MOV B,#look corpse{STRING}
MOV A,U${STRING}
CHGCTX #0
JSR SEQ
PUSH X
MOV Y,#4{INTEGER}
MOV X,I{REAL}
EQ X,Y
POP Y
AND X,Y
PUSH X
MOV Y,#0{INTEGER}
MOV X,K{REAL}
EQ X,Y
MOV Y,#6{INTEGER}
ADD X,Y
POP Y
MUL X,Y
PUSH X
CHGCTX #1
MOV B,#inventory{STRING}
MOV A,U${STRING}
CHGCTX #0
JSR SEQ
PUSH X
MOV Y,K{REAL}
MOV X,#6{INTEGER}
SUB X,Y
POP Y
MUL X,Y
PUSH X
CHGCTX #1
MOV B,# {STRING}
MOV A,U${STRING}
JSR CONCAT
MOV B,#look {STRING}
CHGCTX #0
JSR SEQ
PUSH X
MOV Y,I{REAL}
MOV X,#5{INTEGER}
ADD X,Y
POP Y
MUL X,Y
MOV Y,X
MOV X,A{REAL}
SUB X,Y
POP Y
SUB X,Y
POP Y
SUB X,Y
MOV A{REAL},X
7:
NOP
MOV X,J{REAL}
MOV A,#3{INTEGER}
MOV Y,X
SHL X,A
MOV A,#1{INTEGER}
SHL Y,A
ADD X,Y
PUSH X
MOV Y,I{REAL}
MOV X,#100{INTEGER}
MUL X,Y
POP Y
ADD X,Y
MOV Y,K{REAL}
ADD X,Y
MOV B{REAL},X
NOP
MOV B,#get sword{STRING}
MOV A,U${STRING}
CHGCTX #0
JSR SEQ
PUSH X
MOV Y,#211{INTEGER}
MOV X,B{REAL}
EQ X,Y
POP Y
AND X,Y
MOV A,#3{INTEGER}
MOV Y,X
SHL X,A
MOV A,#1{INTEGER}
SHL Y,A
ADD X,Y
PUSH X
CHGCTX #1
MOV B,#open chest{STRING}
MOV A,U${STRING}
CHGCTX #0
JSR SEQ
PUSH X
MOV Y,#201{INTEGER}
MOV X,B{REAL}
EQ X,Y
POP Y
AND X,Y
MOV A,#1{INTEGER}
SHL X,A
PUSH X
CHGCTX #1
MOV B,#get key{STRING}
MOV A,U${STRING}
CHGCTX #0
JSR SEQ
PUSH X
MOV Y,#400{INTEGER}
MOV X,B{REAL}
EQ X,Y
POP Y
AND X,Y
MOV A,#3{INTEGER}
MOV Y,X
SHL X,A
MOV A,#1{INTEGER}
SHL Y,A
ADD X,Y
MOV Y,X
MOV X,A{REAL}
SUB X,Y
POP Y
SUB X,Y
POP Y
SUB X,Y
MOV A{REAL},X
8:
NOP
MOV Y,M{REAL}
MOV X,I{REAL}
ADD X,Y
MOV I{REAL},X
NOP
MOV Y,#2{INTEGER}
MOV X,A{REAL}
EQ X,Y
MOV Y,X
MOV X,J{REAL}
SUB X,Y
MOV J{REAL},X
NOP
MOV Y,#10{INTEGER}
MOV X,A{REAL}
EQ X,Y
MOV Y,X
MOV X,K{REAL}
SUB X,Y
MOV K{REAL},X
9:
NOP
JSR COMPACTMAX
MOV X,A{REAL}
MOV A,#3{INTEGER}
MOV Y,X
SHL Y,A
ADD X,Y
MOV Y,#1{INTEGER}
ADD X,Y
PUSH X
MOV C,#9{INTEGER}
PUSH C
CHGCTX #1
MOV B,#taken    you died you won. {STRING}
MOV A,X${STRING}
JSR CONCAT
MOV B,A
POP D
POP C
JSR MID
JSR STROUT
JSR LINEBREAK
10:
NOP
MOV Y,#11{INTEGER}
MOV X,A{REAL}
LT X,Y
CMP X,#0{REAL}
JNE NSKIP0
JMP SKIP0
NSKIP0:
JMP 3
NOP
SKIP0:
NOP
JSR END
RTS
