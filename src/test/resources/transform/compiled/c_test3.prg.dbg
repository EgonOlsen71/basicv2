117	.$818	TSX
118	.$819	STX SP_SAVE
120	.$81c	PROGRAMSTART:
121	.$81c	JSR START
123	.$81f	LINE_0:
126	.$81f	LINE_10:
128	.$81f	LDX #4
129	.$821	dcloop567_1:
130	.$821	LDA CONST_0R,X
131	.$824	STA VAR_I,X
132	.$827	DEX
133	.$828	BPL dcloop567_1
135	.$82a	LDA #<CONST_1R
136	.$82c	LDY #>CONST_1R
137	.$82e	JSR REALFACPUSH
139	.$831	LDA #<CONST_2
140	.$833	LDY #>CONST_2
141	.$835	JSR REALFACPUSH
143	.$838	LDA #<VAR_I
144	.$83a	LDY #>VAR_I
145	.$83c	STA A_REG
146	.$83f	STY A_REG+1
147	.$842	LDA #<CONST_3R
148	.$844	LDY #>CONST_3R
149	.$846	JSR COPY2_XYA_XREG
153	.$849	JSR FASTFOR
154	.$84c	LDY #0
155	.$84e	TYA
156	.$84f	CPY A_REG
157	.$852	BNE COMP_SKP0
158	.$854	CMP A_REG+1
159	.$857	BNE COMP_SKP0
160	.$859	COMP_SKP0:
161	.$859	BNE RBEQ_0
162	.$85b	JMP (JUMP_TARGET)
163	.$85e	RBEQ_0:
164	.$85e	JSR END
165	.$861	RTS
168	.$862	END   LDX SP_SAVE
169	.$865	TXS
176	.$866	RTS
179	.$867	START  LDA ENDSTRBUF+1
180	.$86a	BNE ENDGIVEN
181	.$86c	LDA BASICEND
182	.$86e	STA ENDSTRBUF
183	.$871	LDA BASICEND+1
184	.$873	STA ENDSTRBUF+1
185	.$876	ENDGIVEN LDA #<FPSTACK
186	.$878	LDY #>FPSTACK
187	.$87a	STA FPSTACKP
188	.$87d	STY FPSTACKP+1
189	.$880	LDA #<FORSTACK
190	.$882	LDY #>FORSTACK
191	.$884	STA FORSTACKP
192	.$887	STY FORSTACKP+1
193	.$88a	LDA #<STRBUF
194	.$88c	LDY #>STRBUF
195	.$88e	STA STRBUFP
196	.$891	STY STRBUFP+1
197	.$894	STA HIGHP
198	.$897	STY HIGHP+1
199	.$89a	LDA #0
200	.$89c	STA CHLOCKFLAG
201	.$89f	STA LASTVAR
202	.$8a2	STA LASTVAR+1
203	.$8a5	JSR INITVARS
204	.$8a8	LDA #0
205	.$8aa	STA CMD_NUM
206	.$8ad	STA CHANNEL
207	.$8b0	TAY
208	.$8b1	TAX
212	.$8b2	STA KEYNDX
218	.$8b4	JSR RESTORE
219	.$8b7	CLC
223	.$8b8	RTS
226	.$8b9	INITNARRAY
227	.$8b9	STA TMP_ZP
228	.$8bb	STY TMP_ZP+1
229	.$8bd	LDY #0
230	.$8bf	TYA
231	.$8c0	NINITLOOP STA (TMP_ZP),Y
232	.$8c2	INC TMP_ZP
233	.$8c4	BNE NLOOPNOV
234	.$8c6	INC TMP_ZP+1
235	.$8c8	NLOOPNOV LDX TMP2_ZP
236	.$8ca	BNE NLOOPNOV2
237	.$8cc	DEC TMP2_ZP+1
238	.$8ce	NLOOPNOV2 DEC TMP2_ZP
239	.$8d0	BNE NINITLOOP
240	.$8d2	LDX TMP2_ZP+1
241	.$8d4	BNE NINITLOOP
242	.$8d6	RTS
245	.$8d7	INITSTRARRAY
246	.$8d7	STA TMP_ZP
247	.$8d9	STY TMP_ZP+1
248	.$8db	SINITLOOP LDY #0
249	.$8dd	LDA #<EMPTYSTR
250	.$8df	STA (TMP_ZP),Y
251	.$8e1	LDA #>EMPTYSTR
252	.$8e3	INY
253	.$8e4	STA (TMP_ZP),Y
254	.$8e6	CLC
255	.$8e7	LDA TMP_ZP
256	.$8e9	ADC #2
257	.$8eb	STA TMP_ZP
258	.$8ed	BCC SLOOPNOV1
259	.$8ef	INC TMP_ZP+1
260	.$8f1	SLOOPNOV1 SEC
261	.$8f2	LDA TMP2_ZP
262	.$8f4	SBC #2
263	.$8f6	STA TMP2_ZP
264	.$8f8	BCS SLOOPNOV2
265	.$8fa	DEC TMP2_ZP+1
266	.$8fc	SLOOPNOV2 LDA TMP2_ZP
267	.$8fe	BNE SINITLOOP
268	.$900	LDA TMP2_ZP+1
269	.$902	BNE SINITLOOP
270	.$904	RTS
273	.$905	INITSPARAMS STA TMP3_ZP
274	.$907	STY TMP3_ZP+1
275	.$909	SEC
276	.$90a	SBC #2
277	.$90c	STA TMP_ZP
278	.$90e	TYA
279	.$90f	SBC #0
280	.$911	STA TMP_ZP+1
281	.$913	LDY #0
282	.$915	LDA (TMP_ZP),Y
283	.$917	STA TMP2_ZP
284	.$919	INY
285	.$91a	LDA (TMP_ZP),Y
286	.$91c	STA TMP2_ZP+1
287	.$91e	LDA TMP3_ZP
288	.$920	LDY TMP3_ZP+1
289	.$922	RTS
292	.$923	INITSTRVARS LDA #<STRINGVARS_START  
293	.$925	LDY #>STRINGVARS_START
294	.$927	CMP #<STRINGVARS_END
295	.$929	BNE INITIT1
296	.$92b	CPY #>STRINGVARS_END
297	.$92d	BNE INITIT1
298	.$92f	JMP INITSA2     
299	.$932	INITIT1  STA TMP_ZP
300	.$934	STY TMP_ZP+1
301	.$936	LDY #0
302	.$938	INITSTRLOOP LDA #<EMPTYSTR
303	.$93a	STA (TMP_ZP),Y
304	.$93c	INY
305	.$93d	LDA #>EMPTYSTR
306	.$93f	STA (TMP_ZP),Y
307	.$941	DEY
308	.$942	LDA TMP_ZP
309	.$944	CLC
310	.$945	ADC #2
311	.$947	STA TMP_ZP
312	.$949	LDA TMP_ZP+1
313	.$94b	ADC #0
314	.$94d	STA TMP_ZP+1
315	.$94f	CMP #>STRINGVARS_END
316	.$951	BNE INITSTRLOOP
317	.$953	LDA TMP_ZP
318	.$955	CMP #<STRINGVARS_END
319	.$957	BNE INITSTRLOOP
320	.$959	INITSA2  LDA #<STRINGARRAYS_START 
321	.$95b	LDY #>STRINGARRAYS_START
322	.$95d	CMP #<STRINGARRAYS_END
323	.$95f	BNE ARRAYLOOP
324	.$961	CPY #>STRINGARRAYS_END
325	.$963	BNE ARRAYLOOP
326	.$965	RTS       
327	.$966	ARRAYLOOP CLC
328	.$967	ADC #3
329	.$969	BCC ARRAYSKIP1
330	.$96b	INY
331	.$96c	ARRAYSKIP1 CPY #>STRINGARRAYS_END
332	.$96e	BEQ ARRAYSC
333	.$970	BCC ARRAYSKIP2
334	.$972	JMP ARRAYQUIT
335	.$975	ARRAYSC  CMP #<STRINGARRAYS_END
336	.$977	BCS ARRAYQUIT
337	.$979	ARRAYSKIP2 STA TMP_REG
338	.$97b	STY TMP_REG+1
339	.$97d	JSR INITSPARAMS
340	.$980	LDA TMP_REG
341	.$982	LDY TMP_REG+1
342	.$984	JSR INITSTRARRAY
343	.$987	LDA TMP_ZP
344	.$989	LDY TMP_ZP+1
345	.$98b	JMP ARRAYLOOP
346	.$98e	ARRAYQUIT RTS
349	.$98f	RESTORE  LDA #<DATAS
350	.$991	LDY #>DATAS
351	.$993	STA DATASP
352	.$996	STY DATASP+1
353	.$999	RTS
358	.$99a	FASTFOR  JSR POPREAL
359	.$99d	JSR SGNFAC
360	.$9a0	STA TMP_REG  
361	.$9a2	BCC FFPOSSTEP
362	.$9a4	LDA #<REAL_CONST_MINUS_ONE 
363	.$9a6	LDY #>REAL_CONST_MINUS_ONE
364	.$9a8	JSR MEMARG 
365	.$9ab	JSR FACMUL 
366	.$9ae	FFPOSSTEP JSR FACWORD 
367	.$9b1	STY TMP2_ZP
368	.$9b3	STA TMP2_ZP+1 
369	.$9b5	LDA A_REG
370	.$9b8	LDY A_REG+1
371	.$9bb	JSR REALFAC
372	.$9be	JSR FACWORD
373	.$9c1	STY TMP_ZP
374	.$9c3	STA TMP_ZP+1 
375	.$9c5	JSR POPREAL
376	.$9c8	JSR FACWORD
377	.$9cb	STY TMP2_ZP+2
378	.$9cd	STA TMP2_ZP+3 
379	.$9cf	JSR XREGFAC
380	.$9d2	JSR FACINT
381	.$9d5	STY TMP3_ZP  
382	.$9d7	LDA TMP2_ZP+1
383	.$9d9	BNE STEPNOTONE
384	.$9db	LDA TMP2_ZP
385	.$9dd	CMP #$1
386	.$9df	BNE STEPNOTONE
387	.$9e1	JMP STEPONE
388	.$9e4	STEPNOTONE LDA TMP_REG
389	.$9e6	BEQ FFSTEPZERO
390	.$9e8	ROL
391	.$9e9	FFSTEPZERO BCC FFSTEPPOS
392	.$9eb	FFSTEPNEG LDY #0
393	.$9ed	LDA TMP3_ZP
394	.$9ef	TAX
395	.$9f0	FFNEGLOOP TXA
396	.$9f1	STA (TMP_ZP),Y
397	.$9f3	LDA TMP_ZP
398	.$9f5	SEC
399	.$9f6	SBC TMP2_ZP
400	.$9f8	STA TMP_ZP
401	.$9fa	LDA TMP_ZP+1
402	.$9fc	BCS FFNEGSKIP
403	.$9fe	SBC TMP2_ZP+1
404	.$a00	STA TMP_ZP+1
405	.$a02	FFNEGSKIP CMP TMP2_ZP+3
406	.$a04	BEQ FFNEGCHECK2
407	.$a06	BCS FFNEGLOOP
408	.$a08	JMP FFDONE
409	.$a0b	FFNEGCHECK2 LDA TMP_ZP
410	.$a0d	CMP TMP2_ZP+2
411	.$a0f	BCS FFNEGLOOP
412	.$a11	JMP FFDONE
413	.$a14	FFSTEPPOS LDY #0
414	.$a16	LDA TMP3_ZP
415	.$a18	TAX
416	.$a19	FFPOSLOOP TXA
417	.$a1a	STA (TMP_ZP),Y
418	.$a1c	LDA TMP_ZP
419	.$a1e	CLC
420	.$a1f	ADC TMP2_ZP
421	.$a21	STA TMP_ZP
422	.$a23	LDA TMP_ZP+1
423	.$a25	BCC FFPOSSKIP
424	.$a27	ADC TMP2_ZP+1
425	.$a29	STA TMP_ZP+1
426	.$a2b	FFPOSSKIP CMP TMP2_ZP+3
427	.$a2d	BCC FFPOSLOOP
428	.$a2f	BEQ FFPOSCHECK2
429	.$a31	JMP FFDONE
430	.$a34	FFPOSCHECK2 LDA TMP_ZP
431	.$a36	CMP TMP2_ZP+2
432	.$a38	BCC FFPOSLOOP
433	.$a3a	BEQ FFPOSLOOP
434	.$a3c	FFDONE  LDY TMP_ZP
435	.$a3e	LDA TMP_ZP+1
436	.$a40	JSR INTFAC
437	.$a43	LDX A_REG
438	.$a46	LDY A_REG+1
439	.$a49	LDA #1
440	.$a4b	STA A_REG
441	.$a4e	JMP FACMEM  
443	.$a51	STEPONE LDA TMP_REG
444	.$a53	BEQ OFFSTEPZERO
445	.$a55	ROL
446	.$a56	OFFSTEPZERO BCC OFFSTEPPOS
447	.$a58	OFFSTEPNEG LDY #0
448	.$a5a	LDA TMP3_ZP
449	.$a5c	TAX
450	.$a5d	OFFNEGLOOP TXA
451	.$a5e	STA (TMP_ZP),Y
452	.$a60	LDA TMP_ZP
453	.$a62	BNE ONOOVERFLOW
454	.$a64	DEC TMP_ZP+1
455	.$a66	ONOOVERFLOW DEC TMP_ZP
456	.$a68	LDA TMP_ZP+1
457	.$a6a	OFFNEGSKIP CMP TMP2_ZP+3
458	.$a6c	BEQ OFFNEGCHECK2
459	.$a6e	BCS OFFNEGLOOP
460	.$a70	JMP FFDONE
461	.$a73	OFFNEGCHECK2
462	.$a73	LDA TMP_ZP
463	.$a75	CMP TMP2_ZP+2
464	.$a77	BCS OFFNEGLOOP
465	.$a79	JMP FFDONE
466	.$a7c	OFFSTEPPOS LDY #0
467	.$a7e	LDA TMP3_ZP
468	.$a80	TAX
469	.$a81	OFFPOSLOOP TXA
470	.$a82	STA (TMP_ZP),Y
471	.$a84	INC TMP_ZP
472	.$a86	BNE ONOOVERFLOW2
473	.$a88	INC TMP_ZP+1
474	.$a8a	ONOOVERFLOW2
475	.$a8a	LDA TMP_ZP+1
476	.$a8c	OFFPOSSKIP CMP TMP2_ZP+3
477	.$a8e	BCC OFFPOSLOOP
478	.$a90	BEQ OFFPOSCHECK2
479	.$a92	JMP FFDONE
480	.$a95	OFFPOSCHECK2
481	.$a95	LDA TMP_ZP
482	.$a97	CMP TMP2_ZP+2
483	.$a99	BCC OFFPOSLOOP
484	.$a9b	BEQ OFFPOSLOOP
485	.$a9d	JMP FFDONE
488	.$aa0	REALFACPUSH STA TMP_ZP
489	.$aa2	STY TMP_ZP+1
490	.$aa4	LDX FPSTACKP
491	.$aa7	LDY FPSTACKP+1
492	.$aaa	STX TMP2_ZP
493	.$aac	STY TMP2_ZP+1
494	.$aae	LDY #0
495	.$ab0	LDA (TMP_ZP),Y
496	.$ab2	STA (TMP2_ZP),Y
497	.$ab4	INY
498	.$ab5	LDA (TMP_ZP),Y
499	.$ab7	STA (TMP2_ZP),Y
500	.$ab9	INY
501	.$aba	LDA (TMP_ZP),Y
502	.$abc	STA (TMP2_ZP),Y
503	.$abe	INY
504	.$abf	LDA (TMP_ZP),Y
505	.$ac1	STA (TMP2_ZP),Y
506	.$ac3	INY
507	.$ac4	LDA (TMP_ZP),Y
508	.$ac6	STA (TMP2_ZP),Y
509	.$ac8	TXA    
510	.$ac9	CLC
511	.$aca	ADC #5
512	.$acc	STA FPSTACKP
513	.$acf	BCC NOPVRFPXX
514	.$ad1	INC FPSTACKP+1
515	.$ad4	NOPVRFPXX RTS
518	.$ad5	POPREAL  LDA FPSTACKP
519	.$ad8	SEC
520	.$ad9	SBC #5
521	.$adb	STA FPSTACKP
522	.$ade	BCS NOPVPR
523	.$ae0	DEC FPSTACKP+1
524	.$ae3	NOPVPR  LDA FPSTACKP
525	.$ae6	LDY FPSTACKP+1
526	.$ae9	JMP REALFAC
529	.$aec	COPY2_XYA_XREG
530	.$aec	STA TMP3_ZP
531	.$aee	STY TMP3_ZP+1
532	.$af0	COPY2_XY_XREG
533	.$af0	LDX #<X_REG  
534	.$af2	LDY #0
535	.$af4	LDA (TMP3_ZP),Y
536	.$af6	STA X_REG
537	.$af8	INY
538	.$af9	LDA (TMP3_ZP),Y
539	.$afb	STA X_REG+1
540	.$afd	INY
541	.$afe	LDA (TMP3_ZP),Y
542	.$b00	STA X_REG+2
543	.$b02	INY
544	.$b03	LDA (TMP3_ZP),Y
545	.$b05	STA X_REG+3
546	.$b07	INY
547	.$b08	LDA (TMP3_ZP),Y
548	.$b0a	STA X_REG+4
549	.$b0c	RTS
553	.$b0d	FACWORD
554	.$b0d	LDA FACEXP   
555	.$b0f	BNE DOFACWORD
556	.$b11	STA FACSGN   
557	.$b13	DOFACWORD:
558	.$b13	JMP XFACWORD
562	.$b16	XREGFAC  LDA X_REG+4
563	.$b18	STA FACLO
564	.$b1a	LDA X_REG+3
565	.$b1c	STA FACMO
566	.$b1e	LDA X_REG+2
567	.$b20	STA FACMOH
568	.$b22	LDA X_REG+1
569	.$b24	STA FACSGN
570	.$b26	ORA #$80
571	.$b28	STA FACHO
572	.$b2a	LDA X_REG
573	.$b2c	STA FACEXP
574	.$b2e	LDA #0
575	.$b30	STA FACOV
576	.$b32	RTS
690	.$b33	INITVARS
691	.$b33	JSR INITSTRVARS
692	.$b36	LDA #0
693	.$b38	LDY #4
694	.$b3a	REALINITLOOP0:
695	.$b3a	STA VAR_I,Y
696	.$b3d	DEY
697	.$b3e	BMI REALLOOPEXIT0
698	.$b40	JMP REALINITLOOP0
699	.$b43	REALLOOPEXIT0:
700	.$b43	RTS
704	.$b44	CONSTANTS
707	.$b44	CONST_0R .REAL 2023.0
710	.$b49	CONST_1R .REAL 1024.0
713	.$b4e	CONST_2 .REAL -1.0
716	.$b53	CONST_3R .REAL 32.0
722	.$b58	DATAS
723	.$b58	.BYTE $FF
725	.$b59	CONSTANTS_END
728	.$b59	VARIABLES
730	.$b59	VAR_I .REAL 0.0
731	.$b5e	STRINGVARS_START
733	.$b5e	VAR_TI$ .WORD EMPTYSTR
734	.$b60	STRINGVARS_END
735	.$b60	STRINGARRAYS_START
736	.$b60	STRINGARRAYS_END
737	.$b60	VARIABLES_END
739	.$b60	Y_REG .REAL 0.0
740	.$b65	C_REG .REAL 0.0
741	.$b6a	D_REG .REAL 0.0
742	.$b6f	E_REG .REAL 0.0
743	.$b74	F_REG .REAL 0.0
744	.$b79	A_REG .WORD 0
745	.$b7b	B_REG .WORD 0
746	.$b7d	CMD_NUM .BYTE 0
747	.$b7e	CHANNEL .BYTE 0
748	.$b7f	SP_SAVE .BYTE 0
749	.$b80	TMP2_REG .WORD 0
750	.$b82	TMP3_REG .WORD 0
751	.$b84	TMP4_REG .WORD 0
752	.$b86	AS_TMP .WORD 0
753	.$b88	BPOINTER_TMP .WORD 0
754	.$b8a	BASICTEXTP .BYTE 0
755	.$b8b	STORE1 .WORD 0
756	.$b8d	STORE2 .WORD 0
757	.$b8f	STORE3 .WORD 0
758	.$b91	STORE4 .WORD 0
759	.$b93	GCSTART .WORD 0
760	.$b95	GCLEN .WORD 0
761	.$b97	GCWORK .WORD 0
762	.$b99	INPUTLENGTH .BYTE 0
763	.$b9a	TMP_FREG .REAL 0
764	.$b9f	TMP2_FREG .REAL 0
765	.$ba4	TMP_FLAG .BYTE 0
766	.$ba5	INT_FLAG .BYTE 0
767	.$ba6	REAL_CONST_ONE .REAL 1.0
768	.$bab	REAL_CONST_ZERO .REAL 0.0
769	.$bb0	REAL_CONST_MINUS_ONE .REAL -1.0
770	.$bb5	CHLOCKFLAG .BYTE 0
771	.$bb6	EMPTYSTR .BYTE 0
772	.$bb7	FPSTACKP .WORD FPSTACK
773	.$bb9	FORSTACKP .WORD FORSTACK
774	.$bbb	DATASP .WORD DATAS
775	.$bbd	LASTVAR .WORD 0
776	.$bbf	LASTVARP .WORD 0
777	.$bc1	HIGHP .WORD STRBUF
778	.$bc3	STRBUFP .WORD STRBUF
779	.$bc5	ENDSTRBUF .WORD 0
780	.$bc7	INPUTQUEUEP .BYTE 0
781	.$bc8	PROGRAMEND
782	.$bc8	INPUTQUEUE .ARRAY $0F
783	.$bd7	FPSTACK .ARRAY 100
784	.$c3b	FORSTACK .ARRAY 340
785	.$d8f	STRBUF .BYTE 0
