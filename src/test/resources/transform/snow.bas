10 dimi,po,pt,ch,ix,fl,nx:poke646,1:printchr$(147):poke53280,0:poke53281,0
30 cn=20:dimp(cn),ty(cn):d=(1/255)*cn
35 fori=0tocn:ty(i)=42:next:lp=0
40 poke54286,30:poke54287,0:poke54290,129
50 i=peek(54299)*d
60 ifp(i)=0thenp(i)=int(peek(54299)/6.375)+1024:ty(i)=42
70 fori=0tocn:pt=p(i)
80 ifpt=0thennext:goto50
85 ifpeek(pt)<98thenpokept,32
90 po=pt+40:p(i)=po:pc=ty(i)
100 ifpo>2023thenpokept,100:p(i)=0:lp=i:next:goto50
110 ch=peek(po):ifch=32orch=42thenpokepo,pc:next:goto50
111 ifpc=46orch=100or(ch=32andpo>1983)then119
112 ix=po-1024:ix=ix-int(ix/40)*40
113 ifix>1thennx=po-1:gosub2000
114 ifix<39thennx=po+1:gosub2000
119 ifch=160thenp(i)=po-40:ch=peek(p(i))
120 cp=p(i):gosub1000:iffl=1thenp(i)=0:lp=i
310 next:goto50
1000 fl=0:ch=peek(cp):ifch=32thenpc=100:goto1500
1004 ifch=100thenpc=121:goto1500
1005 ifch=121thenpc=98:goto1500
1010 ifch=98thenpc=248:goto1500
1020 ifch=248thenpc=247:goto1500
1030 ifch=247thenpc=160:goto1500
1040 return
1500 fl=1:pokecp,pc:return
2000 nf=nx-40:ifpeek(nf)<>32thenreturn
2001 ifp(lp)=0thenp(lp)=nf:ty(lp)=46:pokenf,46:return
2005 forz=0tocn:ifp(z)=0thenp(z)=nf:ty(z)=46:pokenf,46:return
2010 next:return